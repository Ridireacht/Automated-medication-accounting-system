<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Прогнозирование потребности в товарах</title>
  <link rel="stylesheet" type="text/css" href="/css/styles.css">
</head>
<body>

<h1 style="text-align: center;">Прогнозирование потребности в товарах</h1>

<div class="add-form">
  <label for="product-id">Выберите товар, для которого нужно произвести прогнозирование:</label><br>
  <select id="product-id">
    <option th:each="product : ${products}" th:value="${product.id}" th:text="${product.name}"></option>
  </select><br><br>
</div>

<div style="margin-top: 60px;"></div>

<div class="add-form">
  <p>Количество проанализированных недель: <span id="weeksAnalyzed"></span></p>
  <p>Прогноз расхода товара на следующую неделю: <span id="nextWeekOutflowPrediction"></span> штук</p>
  <hr>
  <p>Количество проанализированных месяцев: <span id="monthsAnalyzed"></span></p>
  <p>Прогноз расхода товара на следующий месяц: <span id="nextMonthOutflowPrediction"></span> штук</p>
</div>

<div style="text-align: center;">
  <a href="/home" class="home-button">Домой</a>
</div>

<script>
  function getPredictionData() {
    var productId = document.getElementById("product-id").value;
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            if (xhr.status === 200) {
                var response = JSON.parse(xhr.responseText);
                document.getElementById('weeksAnalyzed').textContent = response.weeksAnalyzed;
                document.getElementById('monthsAnalyzed').textContent = response.monthsAnalyzed;
                document.getElementById('nextWeekOutflowPrediction').textContent = response.nextWeekOutflowPrediction;
                document.getElementById('nextMonthOutflowPrediction').textContent = response.nextMonthOutflowPrediction;
            } else {
                console.error('Ошибка при выполнении запроса:', xhr.status);
            }
        }
    };
    xhr.open('GET', '/prediction/' + productId);
    xhr.send();
  }

  document.addEventListener("DOMContentLoaded", function() {
    getPredictionData();
  });

  document.getElementById('product-id').addEventListener('change', function() {
    getPredictionData();
  });
</script>
</body>
</html>